<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit page</title>
    <script src="resumes.js" type="text/javaScript"></script>
    <style>

        body{
           background-color:palevioletred;
        }

        /* label{

          font-size:medium;
        }

        input{
            background-color: black;
            color:white;
         
        } */

    </style>
</head>
<body>
    <h1>Edit page</h1>

    <label>Title</label>
    <input type="text" id="input"/><br><br>

    <label>Name</label>
    <input type="text" id="changename"/><br><br>

    <label>Email</label>
    <input type="text" id="editemail"/><br<br><br>
    <br>

    <label>Address</label>
    <input type="text" id="editaddress"/><br><br>

    <label>Phone</label>
    <input type="text" id="editphone"/><br><br>

    <label>LinkedIn</label>
    <input type="text" id="editlinkedin"/><br><br>

    <label>Github</label>
    <input type="text" id="editgithub"/><br><br>

    <label>Summary</label>
     <input type="text" id="editsummary"/><br><br>

    <label>Hard Skills</label>
    <div id="edit_hardskill">
      
    </div>
    <button type="button" onclick="add_detail('edit_hardskill')">Add hard skill</button><br><br>

    <label>Soft Skills</label>
    <div id="edit_softskill"></div>
      
    <button type="button" onclick="add_detail('edit_softskill')">Add soft skill</button><br><br>

    <label>Languages_known</label>
    <div id="edit_language">

    </div>
    <button type="button" onclick="add_detail('edit_language')">Add language</button><br>

    <label>Hobbies</label>
    <div id="edit_hobby">

    </div>

    <button type="button"  onclick="add_detail('edit_hobby')">Add hobby</button><br>
   
    <label>Education</label>
    <table border="1">
     <thead>
        <th>Course Name</th>
        <th>Ins Name</th>
        <th>Percentage</th>
        <th>Year</th>
     </thead>
     <tbody id="edit_educat">

     </tbody>
    </table>
    <button type="button" onclick="createNewEducation()">Add education</button>

   

    <label>Projects</label>
    <table border="1">
        <thead>
            <th>Project_name</th>
            <th>duration</th>
            <th>Team size</th>
            <th>Organization</th>
        </thead>
        <tbody id="edit_project">

        </tbody>
    </table>

    <button type="button" onclick="createNewProject()">Add New Project</button>

    <label>Experience</label>
    <table border="1">
        <thead>
            <th>company_name</th>
            <th>year_of_experience</th>
        </thead>
        <tbody id="edit_experience">

        </tbody>
    </table>
    
    <button type="button" onclick="createNewExperience()">Add New Experience</button>

    <label>Certificates</label>
    <table border="1">
        <thead>
            <th>course_name</th>
            <th>year</th>
        </thead>
        <tbody id="edit_certify">

        </tbody>
    </table>

    <button type="button" onclick="createNewCertificates()">Add New Certificates</button>

 
    
    <button type="button" id="update_Data">Update</button>

    <button type="button" onclick="removeData()" >Logout</button>
</body>

<script>


function removeData(){
    localStorage.removeItem("userdatas")
    location="login.html"
}

</script>


<script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getFirestore, getDocs, collection, doc, addDoc, onSnapshot, setDoc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC47oEKcVbL5T7R_F783tevqcFTH8R1EHo",
      authDomain: "resumes-c23f8.firebaseapp.com",
      projectId: "resumes-c23f8",
      storageBucket: "resumes-c23f8.appspot.com",
      messagingSenderId: "156434018847",
      appId: "1:156434018847:web:acd23159dd1b48da375b2a"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    
      // Initialize Cloud Firestore and get a reference to the service
    const db = getFirestore(app);
    

  
    
    let params = new URLSearchParams(document.location.search);
    let id = params.get("id");

    getDocs(collection(db,"resumes")).then(docSnap=>{
    docSnap.forEach((doc)=>{
        if(id==doc.id){
            let resumeData=doc.data()

    //single values show in input box

    document.getElementById("input").value=resumeData.title
        
    document.getElementById("changename").value=resumeData.name
    document.getElementById("editemail").value=resumeData.email
    document.getElementById("editaddress").value=resumeData.address
    document.getElementById("editphone").value=resumeData.phone
    document.getElementById("editsummary").value=resumeData.summary
    document.getElementById("editlinkedin").value=resumeData.linkedin
    document.getElementById("editgithub").value=resumeData.github
  

    //   //to show skills value in input box  

let hardskill_add="";

for (let each of resumeData.hard_skills){
     hardskill_add= hardskill_add + `<input type="text" value="${each}" class="hardskill_input"></input>`
    }
document.getElementById("edit_hardskill").innerHTML=hardskill_add


let softskill_add="";

for (let each of resumeData.soft_skills){
     softskill_add= softskill_add + `<input type="text" value="${each}" class="softskill_input"></input>`
    }
document.getElementById("edit_softskill").innerHTML=softskill_add

//   //add extra skill input box function

//     // function addingSkill(){
//     //     let data=localStorage.getItem("detail");
//     //     let converted=JSON.parse(data);

//     //     let skill_in=`<input type="text" class="skill_input"/>`

//     //     document.getElementById("editskill").innerHTML=skill_add+skill_in
   
//     // }
//     //    localStorage.setItem("detail",JSON.stringify(converted))


//     //to show language value in input box

let language=""

for (let each of resumeData.languages_known){
    language =language + `<input type="text" value="${each}" class="language_input"></input>`
    
}
document.getElementById("edit_language").innerHTML=language

//     //add extra language input box function

//     // function addinglanguage(){
//     //     let data=localStorage.getItem("detail")
//     //     let converted=JSON.parse(data);

//     //     let input=`<input type="text" class="language_input"/>`

//     //     document.getElementById("editlanguage").innerHTML=language+input
//     // }

//     // localStorage.setItem("detail",JSON.stringify(converted))


//     //to show hobbie value in input box

let hobbie=""

for (let each of resumeData.hobbies){
    hobbie= hobbie + `<input type="text" value="${each}" class="hobby_input"></input>`
}
document.getElementById("edit_hobby").innerHTML=hobbie

//     //add extrea hobbie input box function

//     // function addinghobby(){

//     //     let data=localStorage.getItem("detail")
//     //     let converted=JSON.parse(data);
//     //     let newdata=`<input type="text" class="hobby_input"/>`
//     //     document.getElementById("edithobby").innerHTML=hobbie + newdata
//     // }
//     // localStorage.setItem("detail",JSON.stringify(converted))


// //to show education value in education input box






let educate=""

for (let each in resumeData.education){
    educate=educate + `<tr> 
        <td> <input type="text" value=${resumeData.education[each].course_name} class="course_input"></input></td>
        <td> <input type="text" value=${resumeData.education[each].ins_name} class="ins_input"></input></td>
        <td> <input type="text" value=${resumeData.education[each].percentage} class="percent_input"></input></td>
        <td> <input type="text" value=${resumeData.education[each].year} class="year_input"></input></td>
        </tr>`
    
    }
    document.getElementById("edit_educat").innerHTML=educate

// //to show experience value in input box

let experienc=""

for (let each in resumeData.experience){
experienc=experienc + `<tr>
    <td> <input type="text" value=${resumeData.experience[each].company_name} class="company_input" ></input></td>
    <td> <input type="text" value=${resumeData.experience[each].year_of_experience} class="experience_input"></input></td>
   <tr>`

}

document.getElementById("edit_experience").innerHTML=experienc


// //education,projects,experience,certificates onkeyup update function:  


// // function storeData(ele,ind,key,p_key){
// //     let params = new URLSearchParams(document.location.search);
// //     let index = params.get("index");

// //     let data=localStorage.getItem("detail")
// //     let converted=JSON.parse(data);

// //     // converted[index].education[ind][key]=ele.value;
// //     converted[index][p_key][ind][key]=ele.value
// //     localStorage.setItem("detail",JSON.stringify(converted))

// //    }


// //to show projects value in input box

let proj=""

for (let each in resumeData.projects){
    proj = proj + `<tr>
        <td> <input type="text" value=${resumeData.projects[each].project_name} class="title_input" ></input></td>
        <td> <input type="text" value=${resumeData.projects[each].duration} class="duration_input" ></input></td>
        <td> <input type="text" value=${resumeData.projects[each].team_size} class="teamsize_input"></input></td>
        <td> <input type="text" value=${resumeData.projects[each].organization} class="organization_input" ></input></td>
        </tr>`
}
document.getElementById("edit_project").innerHTML=proj


// //to show certificates value in input box

let certificat=""

for (let each in resumeData.certificates){

certificat=certificat + `<tr> 
   
    <td> <input type="text" value=${resumeData.certificates[each].course_name} class="certify_input" ></input></td>
    <td> <input type="text" value=${resumeData.certificates[each].year} class="certify_input" ></input></td>
    </tr>`
    
}
document.getElementById("edit_certify").innerHTML=certificat

}       

    

    });
})
    








// function createNewEducation(){
    
//     let data=localStorage.getItem("detail")
//     let converted=JSON.parse(data);
 
//     let tbody=document.getElementById("edit_educat").innerHTML
//     let educate_length=converted[index].education.length
    
    
//     let new_education=`<tr><td> <input type="text" onkeyup="storeData(this,${educate_length},'course_name','education')"/></td>
//                  <td> <input type="text" onkeyup="storeData(this,${educate_length},'ins_name','education')"/></td>
//                  <td> <input type="text" onkeyup="storeData(this,${educate_length},'percentage','education')"/></td>
//                  <td> <input type="text" onkeyup="storeData(this,${educate_length},'year','education')"/></td>
//             </tr>`
   
//      document.getElementById("edit_educat").innerHTML=tbody + new_education
   
  


//      converted[index].education[educate_length]=
//                                                   {
//                                                   course_name:"",
//                                                   ins_name:"",
//                                                   percentage:"",
//                                                   year:""
//                                               }

//      localStorage.setItem("detail",JSON.stringify(converted))
//     }


 // to create new input row in experience

    // function createNewExperience() {

    //     let data=localStorage.getItem("detail")
    //     let converted=JSON.parse(data);

    //     let exit_experience=document.getElementById("edit_experience").innerHTML
    //     let experience_length=converted[index].experience.length

    //     let new_experience=`<tr>
    //     <td> <input type="text" onkeyup="storeData(this,${experience_length},'company_name','experience')"></input></td>
    //     <td> <input type="text" onkeyup="storeData(this,${experience_length},'year_of_experience','experience')"></input></td>
    //    <tr>`

    //     document.getElementById("edit_experience").innerHTML=exit_experience + new_experience

    //     converted[index].experience[experience_length]={
    //                                             company_name:"",
    //                                             year_of_experience:""
    //                                             }


    //     localStorage.setItem("detail",JSON.stringify(converted))
    // }

    // //to create new input row in certificates

    // function createNewCertificates(){
     
    //     let data=localStorage.getItem("detail")
    //     let converted=JSON.parse(data);

    //     let exit_certificate=document.getElementById("edit_certify").innerHTML
    //     let certificate_length=converted[index].certificates.length

    //     let new_certificate=`<tr>
    //         <td> <input type="text" onkeyup="storeData(this,${certificate_length},'course_name','certificates')"></input></td>
    //         <td> <input type="text" onkeyup="storeData(this,${certificate_length},'year','certificates')"></input></td>
    //         <tr>`

    //     document.getElementById("edit_certify").innerHTML=exit_certificate + new_certificate

    //     converted[index].certificates[certificate_length]={
    //                                                      course_name:"",
    //                                                      year:""
    //                                                       }

    //     localStorage.setItem("detail",JSON.stringify(converted))
    // }
   
    //to create new input row using add project button 
                           
//    function createNewProject(){

//         let data=localStorage.getItem("detail")
//         let converted=JSON.parse(data);

//         let exit_project=document.getElementById("edit_project").innerHTML
//         let project_length=converted[index].projects.length

//         let new_project=`<tr>
//             <td> <input type="text" onkeyup="storeData(this,${project_length},'project_name','projects')"></input></td>
//             <td> <input type="text" onkeyup="storeData(this,${project_length},'duration','projects')"></input></td>
//             <td> <input type="text" onkeyup="storeData(this,${project_length},'team_size','projects')"></input></td>
//             <td> <input type="text" onkeyup="storeData(this,${project_length},'organization','projects')"></input></td>
//             </tr>`

//             document.getElementById("edit_project").innerHTML=exit_project + new_project

//             converted[index].projects[project_length]={
//                                                   project_name:"",
//                                                   duration:"",
//                                                   team_size:"",
//                                                   organization:""
//                                                   }

//                 localStorage.setItem("detail",JSON.stringify(converted))
//             }
   




//     else if(id=="edit_educat"){
//         let data=localStorage.getItem("detail")
//         let converted=JSON.parse(data);
    
//         let education_length=converted[index].education.length;
//         let t_body_id=document.getElementById("edit_educat").innerHTML;
//         let add_education=`<tr>
//         <td><input type="text" onkeyup="setData(this,${education_length},'course_name','education')"></td>
//         <td><input type="text" onkeyup="setData(this,${education_length},'ins_name','education')"></td>
//         <td><input type="text" onkeyup="setData(this,${education_length},'percentage','education')"></td>
//         <td><input type="text" onkeyup="setData(this,${education_length},'year','education')"></td>
//     </tr>`
//     document.getElementById("edit_educat").innerHTML=t_body_id+add_education

//     converted[index].education[education_length]={
//                                                     course_name:"",
//                                                     ins_name:"",
//                                                     percentage:"",
//                                                     year:""
//     }
// }
    
    
//     else if(id=="edit_project"){
//         let data=localStorage.getItem("detail")
//         let converted=JSON.parse(data);
//         let projects_length=converted[index].projects.length
//         let t_body_id=document.getElementById("edit_project").innerHTML
//         let add_projects=`<tr>
//         <td><input type="text" onkeyup="setData(this,${projects_length},'project_name','projects')" ></td>
//         <td><input type="text" onkeyup="setData(this,${projects_length},'duration','projects')" ></td>
//         <td><input type="text" onkeyup="setData(this,${projects_length},'team_size','projects')" ></td>
//         <td><input type="text" onkeyup="setData(this,${projects_length},'organization','projects')" ></td>
//     </tr>`

//     document.getElementById("edit_project").innerHTML=t_body_id+add_projects

//     converted[index].projects[projects_length]={
//         project_name:"",
//         duration:"",
//         team_size:"",
//         organization:""
//     }
// }


//     else if(id=="edit_experience"){
//         let data=localStorage.getItem("detail")
//         let converted=JSON.parse(data);
//         let experience_length=converted[index].experience.length
//         let t_body_id=document.getElementById("edit_experience").innerHTML
//         let add_experience=`<tr>
//         <td><input type="text" onkeyup="setData(this,${experience_length},'company_name','experience')"></td>
//         <td><input type="text" onkeyup="setData(this,${experience_length},'year_of_experience','experience')"></td>
//        </tr>`

//     document.getElementById("edit_experience").innerHTML=t_body_id+add_experience

//     converted[index].experience[experience_length]={
//         company_name:"",
//         year_of_experience:"",
       
//     }
// }
    
    
//     else if(id=="edit_certify"){
//         let parms = new URLSearchParams(document.location.search);
//         let index = parms.get("index");
//         let data=localStorage.getItem("detail")
//         let converted=JSON.parse(data);

//          let certificate_length=converted[index].certificates.length
//          let t_body_id=document.getElementById("edit_certify").innerHTML
//          let add_certificate= `<tr> 
   
//     <td> <input type="text" onkeyup="setData(this,${certificate_length},'course_name','certificates')"></input></td>
//     <td> <input type="text" onkeyup="setData(this,${certificate_length},'year','certificates')"></input></td>
//     </tr>`
    

//     document.getElementById("edit_certify").innerHTML=t_body_id + add_certificate
//     converted[index].certificates[certificate_length]={
//     course_name:"",
//     year:""

//     }
// }

    // localStorage.setItem("details", JSON.stringify(converted));


update_Data.addEventListener('click',async(e) => {
  
    let update_title=document.getElementById("input").value;
    let update_name=document.getElementById("changename").value;
    let update_email=document.getElementById("editemail").value;
    let update_address=document.getElementById("editaddress").value;
    let update_phone=document.getElementById("editphone").value;
    let update_summary=document.getElementById("editsummary").value;
    let update_linkedin=document.getElementById("editlinkedin").value;
    let update_github=document.getElementById("editgithub").value;
   
    let update_hardskill=document.getElementsByClassName("hardskill_input")
    let edithardskill=[]
    for (let each of update_hardskill){
        edithardskill.push(each.value)
    }
    let update_softskill=document.getElementsByClassName("softskill_input")
    let editsoftskill=[]
    for (let each of update_softskill){
        editsoftskill.push(each.value)
    }
    let update_hobby=document.getElementsByClassName("hobby_input")
    let edithobby=[]
    for (let each of update_hobby){
        edithobby.push(each.value)
    }
    let update_language=document.getElementsByClassName("language_input")
    let editlanguage=[]
    for (let each of update_language){
        editlanguage.push(each.value)
    }
    
   
    getDoc(collection(db,"resumes",id)).then(docSnap=>{
    
    if(docSnap.exists()){
        for (let each in docSnap.data()['education']){
        let update_course=document.querySelector(".course_input").value
        let update_ins=document.querySelector(".ins_input").value
        let update_percent=document.querySelector(".percent_input").value
        let update_year=document.querySelector(".year_input").value


        docSnap.data()['education'][each]['course_name']=update_course
        docSnap.data()['education'][each]['ins_name']=update_ins
        docSnap.data()['education'][each]['percentage']=update_percent
        docSnap.data()['education'][each]['year']=update_year
    
       
 
        for (let each in docSnap.data()['experience']){
        let update_company=document.querySelector(".company_input").value
        let update_yearofexperience=document.querySelector(".experience_input").value
     

        docSnap.data()['experience'][each]['company_name']=update_company
        docSnap.data()['experience'][each]['year_of_experience']=update_yearofexperience

        
   

        for (let each in docSnap.data()['projects']){
        let update_title=document.querySelector(".title_input").value
        let update_duration=document.querySelector(".duration_input").value
        let update_teamsize=document.querySelector(".team_size_input").value
        let update_organization=document.querySelector(".organization_input").value


        docSnap.data()['projects'][each]['project_name']=update_title
        docSnap.data()['projects'][each]['duration']=update_duration
        docSnap.data()['projects'][each]['team_size']=update_teamsize
        docSnap.data()['projects'][each]['organization']=update_organization

    

  updateDoc(doc(db,"resumes",id),{
    title:update_title,
    name:update_name,
    email:update_email,
    address:update_address,
    phone:update_phone,
    summary:update_summary,
    linedin:update_linkedin,
    github:update_github,
    hard_skills:edithardskill,
    soft_skills:editsoftskill,
    
 
       languages_known:editlanguage,
       hobbies:edithobby,


       education:[{
                          course_name:update_course,
                          ins_name:update_ins,
                          percentage:update_percent,
                          year:update_year
               }],
           
        experience:[{
                        company_name:update_company,
                        year_of_experience:update_yearofexperience,
        }],

        projects:[{
                        project_name:update_title,
                        duration:update_duration,
                        team_size:update_teamsize,
                        organization:update_organization,
        }],
    
});
}}
        }

    }
}
    )
})
    
    




// getDoc(doc(db,"resumes",))

  
    



    
    
           

    

</script>

<script>

function add_detail(id){
    
    
    if(id=="edit_hardskill"){
        // Create a new input element skills
    let create_add = document.createElement("input");
    create_add.setAttribute('type', 'text');
    create_add.setAttribute('class', 'hardskill_input'); // Add a class for easier selection

     // Append the input element to the specified container
    document.getElementById("edit_hardskill").appendChild(create_add);
     // Update the skills array in the local storage with the current input value
 
    }

    else if(id=="edit_softskill"){
        // Create a new input element skills
    let create_add = document.createElement("input");
    create_add.setAttribute('type', 'text');
    create_add.setAttribute('class', 'softskill_input'); // Add a class for easier selection
    
     // Append the input element to the specified container
    document.getElementById("edit_softskill").appendChild(create_add);
     // Update the skills array in the local storage with the current input value
 
    }
    else if(id=="edit_hobby"){
        // Create a new input element hobbies
    let create_add = document.createElement("input");
    create_add.setAttribute('type', 'text');
    create_add.setAttribute('class', 'hobby_input'); // Add a class for easier selection 

    // Append the input element to the specified container
    document.getElementById("edit_hobby").appendChild(create_add);

    // Update the hobbies array in the local storage with the current input value
  
    }

    else if(id=="edit_language"){
    // Create a new input element languages
    let create_add = document.createElement("input");
    create_add.setAttribute('type', 'text');
    create_add.setAttribute('class', 'language_input'); // Add a class for easier selection 

    // Append the input element to the specified container
    document.getElementById("edit_language").appendChild(create_add);

    // Update the languages array in the local storage with the current input value
  
    }
    }
      
    


        
    </script>            


  


</html>